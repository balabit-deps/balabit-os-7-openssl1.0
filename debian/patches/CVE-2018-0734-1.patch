From 43e6a58d4991a451daf4891ff05a48735df871ac Mon Sep 17 00:00:00 2001
From: Pauli <paul.dale@oracle.com>
Date: Mon, 29 Oct 2018 08:24:22 +1000
Subject: [PATCH] Merge DSA reallocation timing fix CVE-2018-0734.

Reviewed-by: Richard Levitte <levitte@openssl.org>
(Merged from https://github.com/openssl/openssl/pull/7513)
---
 crypto/dsa/dsa_ossl.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

Index: openssl-1.0.2g/crypto/dsa/dsa_ossl.c
===================================================================
--- openssl-1.0.2g.orig/crypto/dsa/dsa_ossl.c	2018-12-04 08:37:46.938084461 -0500
+++ openssl-1.0.2g/crypto/dsa/dsa_ossl.c	2018-12-04 08:37:46.930084388 -0500
@@ -248,7 +248,7 @@ static int dsa_sign_setup(DSA *dsa, BN_C
         goto err;
 
     /* Preallocate space */
-    q_bits = BN_num_bits(dsa->q);
+    q_bits = BN_num_bits(dsa->q) + sizeof(dsa->q->d[0]) * 16;
     if (!BN_set_bit(&k, q_bits)
         || !BN_set_bit(&l, q_bits)
         || !BN_set_bit(&m, q_bits))
